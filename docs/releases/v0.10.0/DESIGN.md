# v0.10.0 â€” Streaming Video Analysis

**Status:** Draft
**Last Updated:** 2026-02-26
**Discussion:** https://github.com/rogermt/forgesyte/discussions/226

---

## 1. Executive Summary

v0.10.0 introduces **Streaming Video Analysis** â€” real-time progress streaming for video processing jobs via WebSockets, with JSON-safe plugin outputs.

### Six Canonical Deliverables

1. Full patch for `plugin.py` (JSON sanitizer integration)
2. Full manifest update (`streaming_video_analysis` capability)
3. Backend capability resolver
4. Progress callback handler
5. CI SemVer rules
6. Release notes for v0.10.0

### Affected Repositories

| Repository | Changes |
|------------|---------|
| ForgeSyte | Server (WebSocket endpoint, worker broadcast) + Web-UI (progress hook) |
| ForgeSyte-Plugins | YOLO Tracker plugin (JSON sanitizer, manifest) |

---

## 2. Architecture Diagrams

### 2.1 Unified Pipeline Diagram

One shared video pipeline with four tool branches:

```
                                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                   â”‚          User (UI)           â”‚
                                   â”‚ Uploads video + selects tool â”‚
                                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                   â”‚
                                                   â–¼
                                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                   â”‚        ForgeSyte API         â”‚
                                   â”‚ - Capability resolver         â”‚
                                   â”‚ - Job creation                â”‚
                                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                   â”‚
                                                   â–¼
                                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                   â”‚         Worker Node          â”‚
                                   â”‚ - Loads plugin               â”‚
                                   â”‚ - Calls selected tool        â”‚
                                   â”‚ - Streams progress via WS    â”‚
                                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                   â”‚
                                                   â–¼
                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”‚                   YOLO Tracker Plugin v0.10.0                â”‚
                     â”‚                                                              â”‚
                     â”‚   Shared Video Pipeline (all tools use this core loop):      â”‚
                     â”‚   - Load YOLO model                                          â”‚
                     â”‚   - Iterate frames                                           â”‚
                     â”‚   - Run inference                                            â”‚
                     â”‚   - Convert NumPy â†’ JSON-safe (sanitize_json)                â”‚
                     â”‚   - Emit progress (frame/total/percent)                      â”‚
                     â”‚                                                              â”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                             â”‚                                              â”‚
       â–¼                             â–¼                                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ video_player   â”‚           â”‚ video_ball     â”‚                             â”‚ video_pitch    â”‚
â”‚ _tracking      â”‚           â”‚ _detection     â”‚                             â”‚ _detection     â”‚
â”‚ - YOLO + BT    â”‚           â”‚ - YOLO ball    â”‚                             â”‚ - YOLO keypts  â”‚
â”‚ - track IDs    â”‚           â”‚ - ball boxes   â”‚                             â”‚ - pitch lines  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                             â”‚                                              â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â–¼
                             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                             â”‚ video_radar    â”‚
                             â”‚ - YOLO players â”‚
                             â”‚ - center calc  â”‚
                             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                                     â”‚
                                     â–¼
                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”‚                     Progress Event Bus                       â”‚
                     â”‚     (job_store + websocket broadcast to UI)                  â”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                             â”‚
                                             â–¼
                                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                   â”‚          User (UI)           â”‚
                                   â”‚  Sees live progress +        â”‚
                                   â”‚  receives final JSON result  â”‚
                                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 Sequence Diagram

```
User (UI)                Backend API                Worker                 Plugin v0.10.0
   |                          |                        |                         |
   |--- Upload video -------->|                        |                         |
   |                          |                        |                         |
   |   Selects capability     |                        |                         |
   |------------------------->|                        |                         |
   |                          |                        |                         |
   |                          |-- Resolve tool -------->|                         |
   |                          |   (capability + mime)  |                         |
   |                          |                        |                         |
   |                          |-- Create job ---------->|                         |
   |                          |                        |                         |
   |                          |                        |-- Load plugin ---------->|
   |                          |                        |                         |
   |                          |                        |-- Call tool handler ---->|
   |                          |                        |   (video_player_tracking |
   |                          |                        |    or ball/pitch/radar) |
   |                          |                        |                         |
   |                          |                        |   For each frame:        |
   |                          |                        |   - YOLO inference       |
   |                          |                        |   - Branch logic:        |
   |                          |                        |       * tracking         |
   |                          |                        |       * ball detection   |
   |                          |                        |       * pitch keypoints  |
   |                          |                        |       * radar centers    |
   |                          |                        |   - JSON sanitize        |
   |                          |                        |   - Emit progress        |
   |                          |<-----------------------|<-------------------------|
   |<-------------------------|                        |                         |
   |   UI receives progress   |                        |                         |
   |   (frame/total/percent)  |                        |                         |
   |                          |                        |                         |
   |                          |                        |-- Final JSON result ---->|
   |                          |<-----------------------|                         |
   |<-------------------------|                        |                         |
   |   UI displays results    |                        |                         |
   |                          |                        |                         |
```

### 2.3 Class Diagram

```
                                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                      â”‚          User (UI)           â”‚
                                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                     â”‚
                                                     â–¼
                                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                      â”‚         Backend API          â”‚
                                      â”‚  + resolve_tool()            â”‚
                                      â”‚  + create_job()              â”‚
                                      â”‚  + get_progress()            â”‚
                                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                      â”‚
                                                      â–¼
                                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                      â”‚        Job (Domain)          â”‚
                                      â”‚  + id: UUID                  â”‚
                                      â”‚  + tool_id: str              â”‚
                                      â”‚  + status: enum              â”‚
                                      â”‚  + progress: ProgressEvent   â”‚
                                      â”‚  + result: VideoResult       â”‚
                                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                      â”‚
                                                      â–¼
                                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                      â”‚        Worker Node           â”‚
                                      â”‚  + execute_job(job)          â”‚
                                      â”‚  + progress_callback(...)    â”‚
                                      â”‚  + load_plugin()             â”‚
                                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                      â”‚
                                                      â–¼
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚                YOLO Tracker Plugin v0.10.0                 â”‚
                         â”‚                                                            â”‚
                         â”‚  BasePlugin                                                â”‚
                         â”‚  + manifest: Manifest                                      â”‚
                         â”‚  + tools: Dict[str, ToolHandler]                           â”‚
                         â”‚                                                            â”‚
                         â”‚  Shared Video Pipeline                                     â”‚
                         â”‚  + _run_video_tool(video_path, handler)                    â”‚
                         â”‚  + _emit_progress(frame, total)                            â”‚
                         â”‚                                                            â”‚
                         â”‚  Tool Handlers                                             â”‚
                         â”‚  + video_player_tracking()                                 â”‚
                         â”‚  + video_ball_detection()                                  â”‚
                         â”‚  + video_pitch_detection()                                 â”‚
                         â”‚  + video_radar()                                           â”‚
                         â”‚                                                            â”‚
                         â”‚  Dependencies                                              â”‚
                         â”‚  + YOLO model                                              â”‚
                         â”‚  + ByteTrackFactory                                        â”‚
                         â”‚  + get_tracker_ids()                                       â”‚
                         â”‚  + sanitize_json()                                         â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                         â”‚
                                         â–¼
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚                     Domain Model Classes                   â”‚
                         â”‚                                                            â”‚
                         â”‚  VideoResult                                               â”‚
                         â”‚  + total_frames: int                                       â”‚
                         â”‚  + frames: List[FrameResult]                               â”‚
                         â”‚                                                            â”‚
                         â”‚  FrameResult                                               â”‚
                         â”‚  + frame_index: int                                        â”‚
                         â”‚  + detections: DetectionResult                             â”‚
                         â”‚                                                            â”‚
                         â”‚  DetectionResult                                           â”‚
                         â”‚  + tracked_objects: List[TrackedObject]                    â”‚
                         â”‚                                                            â”‚
                         â”‚  TrackedObject                                             â”‚
                         â”‚  + track_id: int                                           â”‚
                         â”‚  + class_id: int                                           â”‚
                         â”‚  + xyxy: List[float]                                       â”‚
                         â”‚  + center: List[float]                                     â”‚
                         â”‚                                                            â”‚
                         â”‚  ProgressEvent                                             â”‚
                         â”‚  + current_frame: int                                      â”‚
                         â”‚  + total_frames: int                                       â”‚
                         â”‚  + percent: int                                            â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.4 UX Flow Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                ForgeSyte UI                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  LEFT SIDEBAR (unchanged)             â”‚  MAIN PANEL                           â”‚
â”‚  - YOLO Tracker Plugin                â”‚                                        â”‚
â”‚     â€¢ video_player_tracking           â”‚  1. User selects tool in sidebar       â”‚
â”‚     â€¢ video_ball_detection            â”‚     (e.g., "Video Player Tracking")    â”‚
â”‚     â€¢ video_pitch_detection           â”‚                                        â”‚
â”‚     â€¢ video_radar                     â”‚  2. Upload panel appears               â”‚
â”‚                                        â”‚     - Video file input                â”‚
â”‚                                        â”‚     - Device selector                 â”‚
â”‚                                        â”‚     - Run button                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

User clicks tool in sidebar
        â”‚
        â–¼
Main panel loads the tool's upload form
        â”‚
        â–¼
User uploads video + clicks "Run"
        â”‚
        â–¼
Backend resolves capability â†’ correct tool
        â”‚
        â–¼
Worker starts processing video
        â”‚
        â–¼
Main panel switches to "Processing" view
- Progress bar
- Frame counter
- Percent
- Optional thumbnail
        â”‚
        â–¼
Worker streams progress events via WebSocket
        â”‚
        â–¼
UI updates progress bar in real time
        â”‚
        â–¼
Worker finishes â†’ returns final JSON
        â”‚
        â–¼
Main panel switches to "Results" view
- Video player with overlays
- Frame timeline
- Object list
- Download JSON
```

### 2.5 UI Component Mockups

The following mockups detail each UI component and its backend connections.

---

#### 2.5.1 Upload Flow Components

##### Sidebar Tool Selector

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FORGESYTE                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  PLUGINS                            â”‚
â”‚  â”œâ”€â”€ YOLO Tracker                   â”‚
â”‚  â”‚   â”œâ”€â”€ â–¸ video_player_tracking    â”‚
â”‚  â”‚   â”œâ”€â”€ â–¸ video_ball_detection     â”‚
â”‚  â”‚   â”œâ”€â”€ â–¸ video_pitch_detection    â”‚
â”‚  â”‚   â””â”€â”€ â–¸ video_radar              â”‚
â”‚  â”‚                                   â”‚
â”‚  â””â”€â”€ (other plugins...)             â”‚
â”‚                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Behavior:**
- This component determines which analysis tool the user wants to run
- Sets `tool_id` in UI state
- Triggers the upload form to load
- No backend call happens at this stage
- Selected tool determines the payload for job creation request

---

##### Upload Form

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Video Player Tracking                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                                                              â”‚ â”‚
â”‚  â”‚    ðŸ“¹ Drop video file here or click to browse               â”‚ â”‚
â”‚  â”‚                                                              â”‚ â”‚
â”‚  â”‚    Supported: MP4, MOV, AVI (max 500MB)                     â”‚ â”‚
â”‚  â”‚                                                              â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                    â”‚
â”‚  Device: [ CPU â–¼ ]                                                â”‚
â”‚                                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                         â–¶ RUN                                â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Backend Connections:**
- Collects video file and device preference
- When user clicks Run:
  1. Sends `POST /v1/jobs` with `{ tool_id, device, video_file }`
  2. Backend stores file, resolves capability, creates job record
  3. Returns `job_id`
- UI then:
  1. Switches to processing view
  2. Subscribes to WebSocket channel `/ws/jobs/{job_id}`

---

#### 2.5.2 Processing Flow Components

##### Processing View

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Processing Video...                                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                    â”‚
â”‚  Tool: video_player_tracking                                       â”‚
â”‚                                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                        42%  (Frame 189 / 450)                      â”‚
â”‚                                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                                                              â”‚ â”‚
â”‚  â”‚    [Video thumbnail preview - optional]                     â”‚ â”‚
â”‚  â”‚                                                              â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                    â”‚
â”‚  â± Elapsed: 0:45   â”‚   â³ Est. remaining: 1:02                    â”‚
â”‚                                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Backend Connections:**
- Listens to WebSocket events from `/ws/jobs/{job_id}`
- Each event includes: `current_frame`, `total_frames`, `percent`
- UI updates progress bar and counters in real time
- Worker emits these events as it processes each frame

**WebSocket Event Format:**
```json
{
  "job_id": "abc123-def456",
  "current_frame": 189,
  "total_frames": 450,
  "percent": 42
}
```

---

##### Worker and Plugin Interaction

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        WORKER NODE                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  1. Load plugin (YOLO Tracker v0.10.0)                             â”‚
â”‚                                                                     â”‚
â”‚  2. Call tool handler (e.g., video_player_tracking)                â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                    FOR EACH FRAME:                            â”‚ â”‚
â”‚  â”‚                                                               â”‚ â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚ â”‚
â”‚  â”‚   â”‚ YOLO        â”‚â”€â”€â”€â–¶â”‚ ByteTrack   â”‚â”€â”€â”€â–¶â”‚ JSON        â”‚      â”‚ â”‚
â”‚  â”‚   â”‚ Inference   â”‚    â”‚ (if needed) â”‚    â”‚ Sanitize    â”‚      â”‚ â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚ â”‚
â”‚  â”‚                                                 â”‚             â”‚ â”‚
â”‚  â”‚                                                 â–¼             â”‚ â”‚
â”‚  â”‚                                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚ â”‚
â”‚  â”‚                                        â”‚ Emit         â”‚      â”‚ â”‚
â”‚  â”‚                                        â”‚ Progress     â”‚      â”‚ â”‚
â”‚  â”‚                                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                     â”‚
â”‚  3. Store final JSON result                                         â”‚
â”‚                                                                     â”‚
â”‚  4. Emit completion event                                           â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

#### 2.5.3 Results Flow Components

##### Results View

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Results - Video Player Tracking                                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                                                  â”‚  â”‚ DETECTED OBJECTS   â”‚ â”‚
â”‚  â”‚                                                  â”‚  â”‚                    â”‚ â”‚
â”‚  â”‚      [Video Player with Detection Overlays]      â”‚  â”‚ â–¡ Player #1 (0.95) â”‚ â”‚
â”‚  â”‚                                                  â”‚  â”‚ â–¡ Player #2 (0.92) â”‚ â”‚
â”‚  â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”                      â”‚  â”‚ â–¡ Player #3 (0.89) â”‚ â”‚
â”‚  â”‚      â”‚ #1    â”‚    â”‚ #2    â”‚                      â”‚  â”‚ â–¡ Player #4 (0.87) â”‚ â”‚
â”‚  â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚  â”‚ â–¡ Ball (0.95)      â”‚ â”‚
â”‚  â”‚                                                  â”‚  â”‚                    â”‚ â”‚
â”‚  â”‚                                                  â”‚  â”‚ Total: 5 objects   â”‚ â”‚
â”‚  â”‚                                                  â”‚  â”‚                    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ [â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] â”‚ â”‚
â”‚  â”‚ Frame: 189 / 450                                                          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚  â¬‡ Download    â”‚  â”‚  ðŸ”„ Re-run     â”‚  â”‚  ðŸ“‹ View JSON  â”‚                   â”‚
â”‚  â”‚     JSON       â”‚  â”‚     Analysis   â”‚  â”‚                â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚                                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Backend Connections:**
- When worker emits completion event, UI switches to this view
- Fetches final JSON via `GET /v1/jobs/{job_id}/result`
- Uses JSON to render:
  - Overlays on video player
  - Frame timeline
  - Object list
- JSON includes: `total_frames`, `frames`, `frame_index`, and detection details

---

##### Export Component

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Export Options                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  â¬‡ Download JSON               â”‚   â”‚
â”‚  â”‚    (v0.10.0 schema)            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  â¬‡ Download CSV                â”‚   â”‚
â”‚  â”‚    (frame-level data)          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  â¬‡ Download Annotations        â”‚   â”‚
â”‚  â”‚    (COCO format)               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Backend Connections:**
- Download JSON: `GET /v1/jobs/{job_id}/result?format=json`
- Triggers browser download
- JSON must be sanitized and match v0.10.0 schema

---

#### 2.5.4 State Transition Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     select tool      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   IDLE      â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶  â”‚   READY     â”‚
â”‚             â”‚                      â”‚ (tool set)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â–²                                     â”‚
     â”‚                                     â”‚ upload + run
     â”‚                                     â–¼
     â”‚                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚     completion              â”‚ PROCESSING  â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ (streaming) â”‚
                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                          â”‚
                                          â”‚ completion event
                                          â–¼
                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                    â”‚   RESULTS   â”‚
                                    â”‚ (JSON view) â”‚
                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                          â”‚
                                          â”‚ download/re-run
                                          â–¼
                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                    â”‚   IDLE      â”‚
                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

#### 2.5.5 Error State Mockup

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âš ï¸ Processing Failed                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                    â”‚
â”‚  Error: Video processing failed                                    â”‚
â”‚  Message: Corrupted frame at index 234                             â”‚
â”‚                                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Job ID: abc123-def456-ghi789                                â”‚ â”‚
â”‚  â”‚  Tool: video_player_tracking                                  â”‚ â”‚
â”‚  â”‚  Failed at: Frame 234 / 450                                   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚  â”‚  ðŸ”„ Retry      â”‚  â”‚  ðŸ“‹ View Logs  â”‚                           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â”‚                                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**WebSocket Error Event:**
```json
{
  "status": "error",
  "job_id": "abc123-def456-ghi789",
  "message": "Video processing failed: corrupted frame at index 234"
}
```

---

## 3. User Stories

### 3.1 Upload + Live Player Tracking

**As a user, I want to upload a football match video and see players tracked in real time while the video is being processed, so that I can monitor progress and verify the analysis is working.**

**Acceptance Criteria:**
- User uploads a video file
- Backend resolves capability â†’ `video_player_tracking`
- Worker streams progress events (`frame`, `total`, `percent`)
- UI updates a progress bar in real time
- Final JSON contains all frames + tracked objects

---

### 3.2 Live Radar Generation

**As a user, I want to generate a radar (bird's-eye) view from a video and see progress as frames are processed, so that I can understand player movement patterns.**

**Acceptance Criteria:**
- Radar tool selected automatically based on capability
- Progress streamed frame-by-frame
- Output JSON includes centers + class IDs

---

### 3.3 Ball Detection on Full-Match Video

**As an analyst, I want to run ball detection on a full match video and receive progress updates, so that I can plan my workflow while the job runs.**

**Acceptance Criteria:**
- Video tool selected automatically
- Worker emits progress events
- JSON output contains ball bounding boxes per frame

---

### 3.4 Pitch Keypoint Detection

**As a user, I want to detect pitch lines and keypoints across a video, so that I can align player positions to the field.**

**Acceptance Criteria:**
- Keypoints extracted per frame
- JSON sanitized (no float32)
- Progress streamed

---

### 3.5 Developer Story: Plugin Authors

**As a plugin developer, I want a stable BasePlugin contract and SemVer rules, so that I can safely add new tools without breaking existing clients.**

**Acceptance Criteria:**
- CI enforces SemVer
- Schema changes â†’ MAJOR bump
- New tools â†’ MINOR bump
- Code-only changes â†’ PATCH bump

---

## 4. Plugin Changes (ForgeSyte-Plugins Repo)

### 4.1 NEW FILE: `forgesyte_yolo_tracker/utils/json_sanitize.py`

**Purpose:** Convert NumPy types into JSON-safe Python types.

**Required Behavior:**
- Convert NumPy floats â†’ Python float
- Convert NumPy ints â†’ Python int
- Convert NumPy arrays â†’ Python list
- Remove values that JSON cannot encode (e.g., `np.bool_`, `np.ndarray`)
- Guarantee no `None`, no `NaN`, no `Inf`
- Recursively sanitize nested structures

**Implementation:**

```python
# forgesyte_yolo_tracker/utils/json_sanitize.py
import numpy as np

def sanitize_json(obj):
    """
    Recursively convert NumPy types into JSON-safe Python types.
    Ensures no np.float32, np.int64, np.ndarray, or other non-serializable
    objects appear in the final plugin output.
    """

    # Dict â†’ sanitize values
    if isinstance(obj, dict):
        return {k: sanitize_json(v) for k, v in obj.items()}

    # List / tuple â†’ sanitize each element
    if isinstance(obj, (list, tuple)):
        return [sanitize_json(v) for v in obj]

    # NumPy array â†’ convert to list
    if isinstance(obj, np.ndarray):
        return sanitize_json(obj.tolist())

    # NumPy floats â†’ Python float
    if isinstance(obj, (np.float32, np.float64)):
        return float(obj)

    # NumPy ints â†’ Python int
    if isinstance(obj, (np.int32, np.int64)):
        return int(obj)

    # Pass through Python primitives
    return obj
```

---

### 4.2 UPDATE: `forgesyte_yolo_tracker/plugin.py`

**Changes:**

1. Import sanitizer:
   ```python
   from forgesyte_yolo_tracker.utils.json_sanitize import sanitize_json
   ```

2. Wrap video tool outputs:
   ```python
   def _tool_video_player_tracking(...):
       # ... processing logic ...
       return sanitize_json({
           "total_frames": frame_index,
           "frames": frame_results,
       })
   ```

3. Fix `track_id` handling:
   ```python
   # Before (broken)
   "track_id": int(tid) if tid else -1,

   # After (fixed)
   tracker_ids = get_tracker_ids(detections)
   if tracker_ids is None:
       tracker_ids = []
   # ... then use tracker_ids ...
   "track_id": int(tid),
   ```

4. Fix float32 conversion for center coordinates:
   ```python
   # Before (broken - may be float32)
   center = [(xyxy[0] + xyxy[2]) / 2, (xyxy[1] + xyxy[3]) / 2]

   # After (fixed)
   center = [
       float((xyxy[0] + xyxy[2]) / 2),
       float((xyxy[1] + xyxy[3]) / 2)
   ]
   ```

---

### 4.3 UPDATE: `manifest.json`

**Changes:**

1. Add `streaming_video_analysis` capability
2. Version bump to `0.10.0`

```json
{
  "id": "yolo-tracker",
  "name": "YOLO Tracker",
  "version": "0.10.0",
  "description": "YOLO + Supervision plugin with streaming video analysis.",
  "capabilities": [
    "player_detection",
    "ball_detection",
    "pitch_detection",
    "radar",
    "streaming_video_analysis"
  ],
  "tools": [
    {
      "id": "video_player_tracking",
      "title": "Video Player Tracking",
      "description": "Track players across video frames.",
      "input_types": ["video"],
      "output_types": ["frames"],
      "capabilities": ["player_detection", "streaming_video_analysis"],
      "inputs": {
        "video_path": "string",
        "device": "string"
      },
      "outputs": {
        "frames": "array",
        "total_frames": "integer"
      }
    }
  ]
}
```

---

## 5. Server Changes (ForgeSyte Repo)

### 5.1 NEW FILE: `app/workers/progress.py`

**Purpose:** Emit WebSocket progress events for video jobs.

**Implementation:**

```python
# app/workers/progress.py
from app.websocket_manager import ws_manager

def progress_callback(job_id: str, current: int, total: int):
    """
    Emit a WebSocket progress event for video jobs.
    
    Args:
        job_id: Job UUID string
        current: Current frame number
        total: Total frames in video
    """
    percent = int((current / total) * 100) if total > 0 else 0

    event = {
        "job_id": job_id,
        "current_frame": current,
        "total_frames": total,
        "percent": percent,
    }

    # Broadcast to all WebSocket subscribers on job topic
    import asyncio
    asyncio.create_task(
        ws_manager.broadcast(event, topic=f"job:{job_id}")
    )
```

---

### 5.2 NEW ENDPOINT: `/ws/jobs/{job_id}` WebSocket

**Purpose:** Real-time progress streaming to UI.

**Implementation Location:** `app/realtime/websocket_router.py` or new file

```python
from fastapi import APIRouter, WebSocket
from app.websocket_manager import ws_manager

router = APIRouter()

@router.websocket("/ws/jobs/{job_id}")
async def job_progress_ws(websocket: WebSocket, job_id: str):
    """
    WebSocket endpoint for real-time job progress updates.
    
    Client subscribes to this endpoint to receive progress events.
    """
    client_id = f"job-{job_id}-{uuid.uuid4()}"
    await ws_manager.connect(websocket, client_id)
    await ws_manager.subscribe(client_id, f"job:{job_id}")
    
    try:
        while True:
            # Keep connection alive, wait for client messages
            data = await websocket.receive_text()
            # Handle ping/pong or other client messages
            if data == "ping":
                await websocket.send_json({"type": "pong"})
    except Exception:
        pass
    finally:
        await ws_manager.unsubscribe(client_id, f"job:{job_id}")
        await ws_manager.disconnect(client_id)
```

---

### 5.3 UPDATE: `app/workers/worker.py`

**Changes:**

1. Import progress callback:
   ```python
   from .progress import progress_callback
   ```

2. Wire callback to video tool execution in `_execute_pipeline()`:
   ```python
   # Create progress callback for video jobs
   if job.job_type in ("video", "video_multi"):
       def make_progress_cb(tool_index: int):
           def cb(current_frame: int, total: int = total_frames) -> None:
               progress_callback(str(job.job_id), current_frame, total)
           return cb
       
       progress_cb = make_progress_cb(idx)
       tool_args["progress_callback"] = progress_cb
   ```

3. Ensure completion event is broadcast:
   ```python
   # On job completion
   asyncio.create_task(
       ws_manager.broadcast(
           {"status": "completed", "job_id": str(job.job_id)},
           topic=f"job:{job.job_id}"
       )
   )
   ```

---

## 6. Web-UI Changes (ForgeSyte Repo)

### 6.1 NEW HOOK: `src/hooks/useJobProgress.ts`

**Purpose:** Subscribe to WebSocket for job progress updates.

**Implementation:**

```typescript
// src/hooks/useJobProgress.ts
import { useEffect, useState, useCallback } from 'react';
import { useWebSocket } from './useWebSocket';

interface ProgressEvent {
  job_id: string;
  current_frame: number;
  total_frames: number;
  percent: number;
}

interface UseJobProgressResult {
  progress: ProgressEvent | null;
  status: 'pending' | 'running' | 'completed' | 'failed';
  isConnected: boolean;
}

export function useJobProgress(jobId: string | null): UseJobProgressResult {
  const [progress, setProgress] = useState<ProgressEvent | null>(null);
  const [status, setStatus] = useState<'pending' | 'running' | 'completed' | 'failed'>('pending');
  const { isConnected, subscribe, onMessage } = useWebSocket();

  useEffect(() => {
    if (!jobId || !isConnected) return;

    // Subscribe to job topic
    subscribe(`job:${jobId}`);

    // Handle incoming messages
    const unsubscribe = onMessage((message) => {
      if (message.job_id === jobId) {
        if (message.status === 'completed') {
          setStatus('completed');
        } else if (message.current_frame !== undefined) {
          setProgress(message);
          setStatus('running');
        }
      }
    });

    return unsubscribe;
  }, [jobId, isConnected, subscribe, onMessage]);

  return { progress, status, isConnected };
}
```

---

### 6.2 UPDATE: `src/components/JobStatus.tsx`

**Changes:**

1. Use WebSocket with HTTP polling fallback
2. Display: frame counter, percent, current tool

```typescript
// Updated JobStatus component
import { useJobProgress } from '../hooks/useJobProgress';

export const JobStatus: React.FC<JobStatusProps> = ({ jobId }) => {
  const { progress, status, isConnected } = useJobProgress(jobId);
  const [pollProgress, setPollProgress] = useState<number | null>(null);

  // Fallback to HTTP polling if WebSocket not connected
  useEffect(() => {
    if (isConnected || !jobId) return;

    const poll = async () => {
      const job = await apiClient.getJob(jobId);
      setPollProgress(job.progress);
      if (job.status === 'completed' || job.status === 'failed') return;
      setTimeout(poll, 2000);
    };
    poll();
  }, [jobId, isConnected]);

  const displayProgress = progress?.percent ?? pollProgress;

  return (
    <div>
      <div>Status: {status}</div>
      {displayProgress !== null && (
        <>
          <progress value={displayProgress} max="100" />
          <span>{displayProgress}%</span>
        </>
      )}
      {progress && (
        <div>
          Frame: {progress.current_frame} / {progress.total_frames}
        </div>
      )}
    </div>
  );
};
```

---

## 7. JSON Schema (Canonical)

All video tool outputs must conform to this schema:

```json
{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "type": "object",
  "required": ["total_frames", "frames"],
  "properties": {
    "total_frames": {
      "type": "integer",
      "minimum": 0
    },
    "frames": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["frame_index", "detections"],
        "properties": {
          "frame_index": {
            "type": "integer",
            "minimum": 0
          },
          "detections": {
            "type": "object",
            "properties": {
              "tracked_objects": {
                "type": "array",
                "items": {
                  "type": "object",
                  "required": ["track_id", "class_id", "xyxy", "center"],
                  "properties": {
                    "track_id": { "type": "integer" },
                    "class_id": { "type": "integer" },
                    "xyxy": {
                      "type": "array",
                      "items": { "type": "number" },
                      "minItems": 4,
                      "maxItems": 4
                    },
                    "center": {
                      "type": "array",
                      "items": { "type": "number" },
                      "minItems": 2,
                      "maxItems": 2
                    }
                  }
                }
              }
            }
          }
        }
      }
    }
  }
}
```

---

## 8. WebSocket Event Format

### Progress Event

```json
{
  "job_id": "abc123-def456-ghi789",
  "current_frame": 189,
  "total_frames": 450,
  "percent": 42
}
```

### Completion Event

```json
{
  "status": "completed",
  "job_id": "abc123-def456-ghi789"
}
```

### Error Event

```json
{
  "status": "error",
  "job_id": "abc123-def456-ghi789",
  "message": "Video processing failed: corrupted frame at index 234"
}
```

---

## 9. CI SemVer Rules

```yaml
name: SemVer Enforcement

on:
  pull_request:
    paths:
      - 'forgesyte_yolo_tracker/plugin.py'
      - 'forgesyte_yolo_tracker/manifest.json'

jobs:
  semver:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Detect schema changes
        run: |
          # Check for input_schema changes
          git diff origin/main -- forgesyte_yolo_tracker/plugin.py | grep "input_schema" && echo "SCHEMA_CHANGED=1" >> $GITHUB_ENV || true
          
          # Check for output_schema changes
          git diff origin/main -- forgesyte_yolo_tracker/plugin.py | grep "output_schema" && echo "SCHEMA_CHANGED=1" >> $GITHUB_ENV || true
          
          # Check for manifest tool changes
          git diff origin/main -- forgesyte_yolo_tracker/manifest.json | grep '"tools"' && echo "TOOLS_CHANGED=1" >> $GITHUB_ENV || true

      - name: Read version
        run: |
          VERSION=$(grep -o '"version"[[:space:]]*:[[:space:]]*"[^"]*"' forgesyte_yolo_tracker/manifest.json | head -1 | grep -o '[0-9]\+\.[0-9]\+\.[0-9]\+')
          echo "VERSION=$VERSION" >> $GITHUB_ENV

      - name: Enforce SemVer
        run: |
          if [ "$SCHEMA_CHANGED" = "1" ]; then
            echo "ERROR: Schema changed â€” MAJOR bump required."
            echo "Current version: $VERSION"
            echo "Expected: Next MAJOR version"
            exit 1
          fi
          
          if [ "$TOOLS_CHANGED" = "1" ]; then
            echo "WARNING: Tools changed â€” MINOR bump recommended."
            echo "Current version: $VERSION"
          fi
          
          echo "SemVer check passed."
```

**Rules Summary:**

| Change Type | Bump Level | Enforcement |
|-------------|------------|-------------|
| Schema change (`input_schema`, `output_schema`) | MAJOR | CI Fail |
| New tools added | MINOR | CI Warning |
| Code-only changes | PATCH | Pass |

---

## 10. Test Plan

### 10.1 JSON Sanitization Unit Tests

| Test | Input | Expected | Pass Criteria |
|------|-------|----------|---------------|
| NumPy float conversion | `np.float32(1.23)` | `1.23` (Python float) | `type(result) is float` |
| NumPy int conversion | `np.int64(42)` | `42` (Python int) | `type(result) is int` |
| NumPy array conversion | `np.array([1,2,3])` | `[1,2,3]` | `type(result) is list` |
| Deep nested sanitization | `{"a": np.array([np.float32(1.0), np.int64(2)])}` | `{"a": [1.0, 2]}` | No NumPy types remain |
| Full plugin output | Run video tool on short clip | Valid JSON | `json.dumps()` succeeds |

### 10.2 WebSocket Progress Streaming Tests

| Test | Action | Expected |
|------|--------|----------|
| WebSocket connection | Connect to `/ws/jobs/{job_id}` | Connection accepted |
| Progress events | Run video job | Events: `{job_id, current_frame, total_frames, percent}` |
| Percent monotonicity | Monitor events | `percent` never decreases, ends at 100 |
| Completion event | Job finishes | `{"status": "completed"}` |
| UI updates | Visual verification | Progress bar moves, frame counter updates |

### 10.3 End-to-End Tests

| Test | Action | Expected |
|------|--------|----------|
| Short video job | Run `video_player_tracking` on 10s clip | WS events + sanitized JSON + UI renders |
| Long video job | Run `video_ball_detection` on 5min video | No WS timeouts, smooth progress |
| All four tools | Run each tool | Consistent behavior, valid schemas |
| Corrupted video | Run on broken file | Graceful failure with error event |

### 10.4 Failure Mode Tests

| Test | Action | Expected |
|------|--------|----------|
| Corrupted video | Process broken MP4 | Job fails with `{"status": "error", "message": "..."}` |
| Worker crash | Kill worker mid-job | UI shows stuck state, polling fallback works |
| Plugin returns bad types | Inject NumPy type | Sanitizer converts, JSON serialization succeeds |

### 10.5 QA Acceptance Criteria

- [ ] 100% of plugin outputs are JSON-serializable without errors
- [ ] WebSocket progress events stream continuously during video processing
- [ ] UI updates in real time
- [ ] Final JSON matches v0.10.0 schema exactly
- [ ] All four tools behave consistently
- [ ] No NumPy types leak into API
- [ ] No regressions in existing image-based tools
- [ ] Error handling is graceful and consistent

---

## 11. Integration Checklist

### UI to Backend

- [ ] Sidebar sets `tool_id` in UI state
- [ ] Upload form sends `POST /v1/video/submit`
- [ ] UI subscribes to `/ws/jobs/{job_id}`
- [ ] UI switches to processing view on job creation
- [ ] UI switches to results view on completion
- [ ] UI fetches final JSON via `GET /v1/jobs/{job_id}`
- [ ] UI renders overlays and supports JSON download

### Backend to Worker

- [ ] Capability resolver selects correct tool
- [ ] Worker loads plugin and calls tool handler
- [ ] Worker emits progress events via WebSocket
- [ ] Worker stores final JSON
- [ ] Worker emits completion event

### Plugin to Worker

- [ ] Plugin uses shared video pipeline
- [ ] Plugin emits progress via callback
- [ ] Plugin returns JSON-safe output via `sanitize_json()`
- [ ] Plugin uses unified v0.10.0 schema

---

## 12. Release Notes Template

```
## v0.10.0 â€” Streaming Video Analysis

This release introduces full streaming video analysis across all YOLO-based tools.

### New
- Real-time video player tracking with ByteTrack
- Video ball detection
- Video pitch detection
- Video radar generation
- WebSocket progress streaming for video jobs (`/ws/jobs/{job_id}`)
- JSON-safe output sanitization for all video tools
- `streaming_video_analysis` capability in plugin manifest

### Fixed
- Removed `.track_id` usage (Supervision API change)
- Eliminated NumPy truth-value ambiguity errors
- Eliminated float32 JSON serialization failures
- Progress now streams in real-time via WebSocket

### API Changes
- New WebSocket endpoint: `/ws/jobs/{job_id}` for real-time progress
- Progress event format: `{job_id, current_frame, total_frames, percent}`

### Compatibility
- No breaking changes to existing image-based tools
- Fully backward compatible with v0.9.x
- HTTP polling still available as fallback

### Migration Notes
- UI should subscribe to `/ws/jobs/{job_id}` for real-time updates
- Fallback to HTTP polling if WebSocket unavailable
- All video tool outputs are now guaranteed JSON-safe
```

---

## 13. Implementation Plan

### 13.1 Workflow Overview

**Approach:** Test-Driven Development (TDD)

1. **Create new branch:** `v0.10.0` from `main`
2. **Split tasks into phases** â€” small, atomic changes
3. **Commit after each phase** â€” one phase = one commit
4. **Run verification after each phase** â€” must be GREEN
5. **Save all outputs** â€” `.log` files in `docs/releases/v0.10.0/`

### 13.2 Phase Breakdown

| Phase | Scope | Repo |
|-------|-------|------|
| 1 | Create JSON sanitizer + unit tests | ForgeSyte-Plugins |
| 2 | Wire sanitizer into plugin.py | ForgeSyte-Plugins |
| 3 | Update manifest.json (capability + version) | ForgeSyte-Plugins |
| 4 | Create progress.py + unit tests | ForgeSyte |
| 5 | Create WebSocket endpoint + unit tests | ForgeSyte |
| 6 | Update worker.py for progress broadcast | ForgeSyte |
| 7 | Create useJobProgress hook + tests | ForgeSyte |
| 8 | Update JobStatus.tsx | ForgeSyte |
| 9 | Integration tests | ForgeSyte |
| 10 | E2E validation | Both |

### 13.3 TDD Workflow (Per Phase)

```
1. Write failing tests FIRST
2. Run tests to confirm RED
3. Implement minimum code to pass
4. Run tests to confirm GREEN
5. Run pre-commit verification
6. Commit with descriptive message
7. Save output to .log file
```

### 13.4 Verification Commands

#### ForgeSyte Repo

```bash
# Python/Server checks
cd /home/rogermt/forgesyte
uv run pre-commit run --all-files          # black/ruff/mypy
cd server && uv run pytest tests/ -v       # all tests
cd .. && python scripts/scan_execution_violations.py  # governance check

# TypeScript/Web-UI checks (ALL THREE required)
cd web-ui
npm run lint                               # eslint
npm run type-check                         # tsc --noEmit (MANDATORY)
npm run test -- --run                      # vitest
```

#### ForgeSyte-Plugins Repo

```bash
cd /home/rogermt/forgesyte-plugins/plugins/forgesyte-yolo-tracker
uv run pre-commit run --all-files
```

### 13.5 Output Logging

All verification outputs must be saved to log files:

```bash
# Example: Save test output to log file
cd /home/rogermt/forgesyte/server
uv run pytest tests/ -v 2>&1 | tee ../docs/releases/v0.10.0/phase1_tests.log

# Example: Save pre-commit output
cd /home/rogermt/forgesyte
uv run pre-commit run --all-files 2>&1 | tee docs/releases/v0.10.0/phase1_precommit.log
```

### 13.6 Phase Checklist Template

For each phase, create a log entry:

```markdown
## Phase X: [Description]

**Date:** YYYY-MM-DD
**Branch:** v0.10.0
**Status:** [ ] In Progress | [ ] Complete

### Files Changed
- `path/to/file1.py` â€” description
- `path/to/file2.ts` â€” description

### Tests Written
- `tests/test_x.py::test_y` â€” description

### Verification Results
- [ ] pre-commit: PASS (see phaseX_precommit.log)
- [ ] pytest: PASS (see phaseX_tests.log)
- [ ] governance: PASS (see phaseX_governance.log)
- [ ] npm lint: PASS (see phaseX_lint.log)
- [ ] npm type-check: PASS (see phaseX_typecheck.log)
- [ ] npm test: PASS (see phaseX_vitest.log)

### Commit
```
git add .
git commit -m "phase(X): description"
```
```

### 13.7 Branch Management

```bash
# Create feature branch from main
git checkout main
git pull origin main
git checkout -b v0.10.0

# After each phase commit
git push origin v0.10.0

# After all phases complete, create PR
gh pr create --base main --head v0.10.0 --title "v0.10.0: Streaming Video Analysis"
```

### 13.8 Rollback Procedure

If a phase fails verification:

```bash
# Reset to last known good state
git reset --hard HEAD

# Or restore specific files
git checkout HEAD -- path/to/file.py

# Re-attempt the phase
```

---

## 14. References

- **GitHub Discussion:** https://github.com/rogermt/forgesyte/discussions/226
- **WebSocket Protocol Spec:** `/docs/design/WEBSOCKET_PROTOCOL_SPEC.md`
- **Plugin Development Guide:** `/PLUGIN_DEVELOPMENT.md`
- **v0.9.7 Release Notes:** `/docs/releases/v0.9.7/OVERVIEW.md`
- **AGENTS.md:** Development commands and conventions
